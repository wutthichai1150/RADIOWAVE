<div class="bg-black bg-opacity-70 rounded-xl p-8 max-w-2xl mx-auto">
  <div class="flex items-center justify-center mb-6">
    <img src="https://picsum.photos/id/1056/60/60" alt="Now Playing" class="h-24 w-24 rounded-full mr-4 now-playing">
    <div class="text-left w-full">
      <p class="text-sm text-gray-400">NOW PLAYING</p>
      <h3 id="songTitle" class="text-xl font-bold">Loading...</h3>
      <p class="text-gray-300 mb-2" id="artistName">Unknown Artist</p>

      <!-- YouTube Player Container (ซ่อน) -->
      <div id="player" style="width: 0; height: 0; overflow: hidden;"></div>

      <!-- Controls -->
      <div class="flex items-center space-x-4">
        <button onclick="togglePlay()" id="playBtn" class="bg-radio-purple hover:bg-radio-pink text-white font-bold py-1 px-4 rounded">
          ▶ Play
        </button>
        <span id="currentTime" class="text-sm text-white">0:00</span>
        <input type="range" id="progressBar" value="0" min="0" max="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
        <span id="duration" class="text-sm text-white">0:00</span>
      </div>
    </div>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
  let player;
  let duration = 0;
  const playBtn = document.getElementById("playBtn");
  const progressBar = document.getElementById("progressBar");
  const currentTimeDisplay = document.getElementById("currentTime");
  const durationDisplay = document.getElementById("duration");
  const songTitle = document.getElementById("songTitle");
  const artistName = document.getElementById("artistName");

  // ฟังก์ชันแปลงเวลา (วินาที -> นาที:วินาที)
  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60).toString().padStart(2, "0");
    return `${mins}:${secs}`;
  }

  // โหลด YouTube IFrame API เสร็จ จะเรียกฟังก์ชันนี้อัตโนมัติ
  function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
      height: "0",
      width: "0",
      videoId: "wxXE8Q_hvOA", // เปลี่ยนเป็น YouTube Video ID ที่ต้องการ
      playerVars: {
        autoplay: 0,
        controls: 0,
        rel: 0,
        showinfo: 0,
        modestbranding: 1,
      },
      events: {
        onReady: onPlayerReady,
        onStateChange: onPlayerStateChange,
      },
    });
  }

  // เมื่อ player พร้อมใช้งาน
  function onPlayerReady(event) {
    songTitle.textContent = "Demo Song Title"; // เปลี่ยนชื่อเพลงตามต้องการ
    artistName.textContent = "Demo Artist";

    // รอโหลด duration จริง ๆ ด้วย setTimeout หรือ setInterval จนกว่าจะได้ค่า > 0
    const waitForDuration = setInterval(() => {
      duration = player.getDuration();
      if (duration > 0) {
        clearInterval(waitForDuration);
        durationDisplay.textContent = formatTime(duration);
        progressBar.max = Math.floor(duration);
        updateProgress();
      }
    }, 100);
  }

  // อัปเดตสถานะปุ่ม Play/Pause ตามสถานะ player
  function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.PLAYING) {
      playBtn.textContent = "⏸ Pause";
      startProgressUpdater();
    } else {
      playBtn.textContent = "▶ Play";
      stopProgressUpdater();
    }
  }

  // เล่น/หยุดเพลง
  function togglePlay() {
    if (!player) return;
    const state = player.getPlayerState();
    if (state !== YT.PlayerState.PLAYING) {
      player.playVideo();
    } else {
      player.pauseVideo();
    }
  }

  let progressInterval;

  // อัปเดตแถบเวลาตามเสียงเล่น
  function updateProgress() {
    if (!player) return;
    const currentTime = player.getCurrentTime();
    progressBar.value = Math.floor(currentTime);
    currentTimeDisplay.textContent = formatTime(currentTime);
  }

  // เริ่มอัปเดตแถบเวลาทุก 500 ms
  function startProgressUpdater() {
    if (progressInterval) clearInterval(progressInterval);
    progressInterval = setInterval(updateProgress, 500);
  }

  // หยุดอัปเดตแถบเวลา
  function stopProgressUpdater() {
    if (progressInterval) {
      clearInterval(progressInterval);
      progressInterval = null;
    }
  }

  // เลื่อนแถบเวลา
  progressBar.addEventListener("input", () => {
    if (player) {
      player.seekTo(progressBar.value, true);
      currentTimeDisplay.textContent = formatTime(progressBar.value);
    }
  });
</script>
